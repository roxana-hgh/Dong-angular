import{k as h}from"./chunk-5JI43ALG.js";var c=class m{storageKey="groupData";groupData={groupName:"",groupDescription:"",groupMembers:[],expenses:[]};constructor(){this.loadData()}findObject(t,e,r){return t.find(o=>o[e]===r)}addGroupDetails(t,e){this.groupData.groupName=t,this.groupData.groupDescription=e||"",this.saveData()}getGroupDetails(){return{name:this.groupData.groupName,description:this.groupData.groupDescription}}addMember(t,e=""){this.groupData.groupMembers.find(r=>r.name===t||e!==null&&r.email===e)||(this.groupData.groupMembers.push({name:t,email:e}),this.saveData())}removeMember(t){this.groupData.groupMembers=this.groupData.groupMembers.filter(e=>e.name!==t),this.saveData()}getMembers(){return this.groupData.groupMembers}addExpense(t){this.groupData.expenses.push(t),this.saveData()}removeExpense(t){let e=this.groupData.expenses.findIndex(r=>r.id===t);e>=0&&e<this.groupData.expenses.length&&(this.groupData.expenses.splice(e,1),this.saveData())}getExpenses(){return this.groupData.expenses}getSingleExpense(t){return console.log(this.groupData.expenses.find(e=>e.id===t)),this.groupData.expenses.find(e=>e.id===t)}editExpense(t,e){let r=this.groupData.expenses.findIndex(o=>o.id===t);r>=0&&r<this.groupData.expenses.length&&(this.groupData.expenses[r]=e,this.saveData())}calculateShares(){let t={};return this.groupData.groupMembers.forEach(e=>{t[e.name]=0}),this.groupData.expenses.forEach(e=>{let r=e.splitBetween.length;if(r>0){let o=e.amount/r;e.splitBetween.forEach(s=>{t[s]=(t[s]||0)+o})}}),t}calculateDirectSettlements(){let t=[],e={};this.groupData.groupMembers.forEach(o=>{e[o.name]={},this.groupData.groupMembers.forEach(s=>{e[o.name][s.name]=0})}),this.groupData.expenses.forEach(o=>{let s=o.paidBy,p=o.splitBetween,a=o.amount/p.length;p.forEach(n=>{n!==s&&(e[n][s]+=a)})});let r=new Set;return this.groupData.groupMembers.forEach(o=>{let s=o.name;this.groupData.groupMembers.forEach(p=>{let a=p.name;if(s!==a){let n=[s,a].sort().join("-");if(!r.has(n)){r.add(n);let i=e[s][a],u=e[a][s];if(i>.01&&u>.01){let g=Math.abs(i-u);g>.01&&(i>u?t.push({from:s,to:a,amount:parseFloat(g.toFixed(2))}):t.push({from:a,to:s,amount:parseFloat(g.toFixed(2))}))}else i>.01&&t.push({from:s,to:a,amount:parseFloat(i.toFixed(2))}),u>.01&&t.push({from:a,to:s,amount:parseFloat(u.toFixed(2))})}}})}),t}calculateMinimizedSettlements(){let t=[],e={};this.groupData.groupMembers.forEach(a=>{e[a.name]=0}),this.groupData.expenses.forEach(a=>{e[a.paidBy]=(e[a.paidBy]||0)+a.amount});let r=this.calculateShares(),o=[];for(let a of this.groupData.groupMembers){let n=a.name,i=e[n]-r[n];o.push({name:n,amount:i})}o.sort((a,n)=>a.amount-n.amount);let s=0,p=o.length-1;for(;s<p;){let a=o[s],n=o[p];if(Math.abs(a.amount)<.01){s++;continue}if(Math.abs(n.amount)<.01){p--;continue}let i=Math.min(Math.abs(a.amount),n.amount);i>.01&&t.push({from:a.name,to:n.name,amount:parseFloat(i.toFixed(2))}),a.amount+=i,n.amount-=i,Math.abs(a.amount)<.01&&s++,Math.abs(n.amount)<.01&&p--}return t}getDetailedBreakdown(){let t={};return this.groupData.groupMembers.forEach(e=>{t[e.name]={paid:0,owed:0,net:0,details:[]}}),this.groupData.expenses.forEach(e=>{t[e.paidBy].paid+=e.amount;let r=e.amount/e.splitBetween.length;e.splitBetween.forEach(o=>{t[o].owed+=r,t[o].details.push({expenseName:e.expenseName,paidBy:e.paidBy,totalAmount:e.amount,shareAmount:r,isPayee:o===e.paidBy})})}),this.groupData.groupMembers.forEach(e=>{t[e.name].net=t[e.name].paid-t[e.name].owed}),t}saveData(){sessionStorage.setItem(this.storageKey,JSON.stringify(this.groupData))}loadData(){let t=sessionStorage.getItem(this.storageKey);if(t)try{this.groupData=JSON.parse(t)}catch(e){console.error("Error parsing group data from sessionStorage:",e),this.groupData={groupName:"",groupDescription:"",groupMembers:[],expenses:[]}}}clearData(){sessionStorage.removeItem(this.storageKey),this.groupData={groupName:"",groupDescription:"",groupMembers:[],expenses:[]}}static \u0275fac=function(e){return new(e||m)};static \u0275prov=h({token:m,factory:m.\u0275fac,providedIn:"root"})};export{c as a};
